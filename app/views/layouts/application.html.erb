<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= content_for(:title) || t('app.title') %></title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <link rel="icon" href="/icon.png" type="image/png">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/icon.png">

  <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>

<body>
<aside class="sidebar">
  <header class="sidebar__header">
    <h1 class="sidebar__title"><%= t('app.name') %></h1>
    <div class="sidebar__actions">
      <%= button_to t('navigation.start_new_chat'),
                    new_conversation_path,
                    method: :get,
                    class: "btn btn--primary sidebar__new" %>
    </div>
  </header>

  <nav class="sidebar__nav" aria-label="<%= t('navigation.chats_list', default: 'Chats list') %>">
    <ul class="chat-list">
      <% Current.user.conversations.order(created_at: :desc).each do |conversation| %>
        <% active = @conversation&.id == conversation.id %>
        <li class="chat-item" id="<%= dom_id(conversation, :row) %>" data-conversation-id="<%= conversation.id %>">
          <%= link_to conversation_path(conversation),
                      class: "chat-link#{' is-active' if active}",
                      aria: { current: (active ? 'page' : nil) } do %>
            <span class="chat-title"><%= conversation.title.presence || t('navigation.untitled_chat') %></span>
          <% end %>

          <%= link_to "🗑️",
                      conversation_path(conversation),
                      class: "chat-delete",
                      data: { turbo_method: :delete },
                      aria: { label: t('navigation.delete_conversation.label') },
                      title: t('navigation.delete_conversation.title') %>
        </li>
      <% end %>
    </ul>
  </nav>
</aside>
<%= yield %>
</body>
</html>
