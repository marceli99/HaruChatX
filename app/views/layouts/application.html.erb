<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= content_for(:title) || t('app.title') %></title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <link rel="icon" href="/icon.png" type="image/png">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/icon.png">

  <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>

<body>
  <aside>
  <header class="logo">
  <h1><%= t('app.name') %></h1>
  </header>

<nav aria-label="Chats list">
  <ul>
    <li>
  <%= button_to t('navigation.start_new_chat'),
                    conversations_path,
                    method: :post,
                    class: "new-chat-btn" %>
    </li>

    <% Current.user.conversations.order(created_at: :desc).each do |conversation| %>
      <% active = (defined?(@conversation) && @conversation&.id == conversation.id) %>
<li id="<%= dom_id(conversation, :row) %>"
    data-conversation-id="<%= conversation.id %>"
    style="display:flex; align-items:center; gap:.5rem;">
  <%= link_to conversation_path(conversation),
              aria: { current: (active ? 'page' : nil) },
              style: 'flex:1; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;' do %>
    <span class="chat-title">
      <%= conversation.title.presence || t('navigation.untitled_chat') %>
    </span>
  <% end %>

  <%= link_to "🗑️",
      conversation_path(conversation),
      data: {
        turbo_method: :delete
              },
      aria: { label: t('navigation.delete_conversation.label') },
      title: t('navigation.delete_conversation.title'),
      style: 'text-decoration:none;' %>
</li>

    <% end %>
  </ul>
</nav>
</aside>
<%= yield %>
</body>
</html>
